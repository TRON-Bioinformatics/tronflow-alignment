image: nextflow/nextflow:20.10.0

# include: '/environment.yml'

before_script:
  - java -version
  - nextflow help
  - wget \
    https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \
    && mkdir /root/.conda \
    && bash Miniconda3-latest-Linux-x86_64.sh -b \
    && rm -f Miniconda3-latest-Linux-x86_64.sh \
    && echo PATH="/root/miniconda3/bin":$PATH >> .bashrc \
    && exec bash \
    && conda --version
  - conda --version

stages:
  - test

test:
  stage: test
  script:
    #nextflow run
    #- make clean test-conda-aln-single
    - nextflow main.nf -profile test,conda
    - ll output
    #- make clean test-conda-aln-paired
    - nextflow main.nf -profile test,conda --library single
    - ll output
    #- make clean test-conda-mem-single
    - nextflow main.nf -profile test,conda --algorithm mem
    - ll output
    #- make clean test-conda-mem-paired
    - nextflow main.nf -profile test,conda --algorithm mem --library single
    - ll output
